<html>
<head>
  <style>

  .text-wrapper {
    position: relative;
    left: 25%;
    top: 20px;
    width: 50%;
    height: 40%;
    display: block;
  }

  .sixkeys {
    width: 100%;
    height: 100%;
  }

  .svg-container {
    position: relative;
    padding-top: 40px;
    width: 100%;
  }

  .svg-wrapper {
    height: 0;
    width: 60%;
    position: relative;
    padding-bottom: 20%;
    margin-left: 20%;
  }

  #svg2 {
    width: 100%;
    height: 100%;
    position: absolute;
  }

  #qwerty {
    transform: translateX(10%);
  }

  @font-face {
      font-family: 'Open Sans';
      font-style: normal;
      font-weight: 400;
      src: local('Open Sans'), local('OpenSans'), url('data:font/woff2;base64,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') format('woff2');
  }

  @font-face {
      font-family: 'Open Sans';
      font-style: normal;
      font-weight: 700;
      src: local('Open Sans Bold'), local('OpenSans-Bold'), url('data:font/woff2;base64,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') format('woff2');
  }

  .rc-ribbon-green-top-right {
      font-family: 'Open Sans', sans-serif;
      display: block;
      overflow: hidden;
      white-space: nowrap;
      margin: 1px 0;
      text-decoration: none;
      padding: 0.5em 3em;
      position: absolute;
      box-shadow: 0 0 0.25em #888;
      color: white;
      background: #61ae24;
      border: 1px solid #79d431;
      -webkit-transform: rotate(45deg);
      -ms-transform: rotate(45deg);
      transform: rotate(45deg);
      top: 4em;
      right: -4em;
      z-index: 2;
  }

  .rc-ribbon-green-top-right strong {
      font-weight: bold;
  }

  .rc-ribbon-green-top-right>a {
      font-size: 0.85em;
      color: inherit;
      text-decoration: none;
  }

  .rc-ribbon-green-top-right>a:visited,
  .rc-ribbon-green-top-right>a:active,
  .rc-ribbon-green-top-right>a:hover,
  .rc-ribbon-green-top-right>a:focus {
      color: inherit;
  }

  .rc-ribbon-green-top-right>a>i.icon-svg svg {
      height: 1.5em;
      margin-bottom: -0.3em;
      margin-right: 0.5em;
  }

  .rc-ribbon-green-top-right>a>span {
      text-align: center;
      text-decoration: none;
  }

  </style>
</head>
<body>
<div class="rc-ribbon-green-top-right"><a href="https://github.com/botwhytho/6-Key-QWERTY" title="Made with love at the Recurse Center"><i class="icon-svg"><svg viewBox="0 0 12 15"><rect x="0" y="0" width="12" height="10" fill="black"></rect><rect x="1" y="1" width="10" height="8" fill="white"></rect><rect x="2" y="2" width="8" height="6" fill="black"></rect><rect x="2" y="3" width="1" height="1" fill="#61ae24"></rect><rect x="4" y="3" width="1" height="1" fill="#61ae24"></rect><rect x="6" y="3" width="1" height="1" fill="#61ae24"></rect><rect x="3" y="5" width="2" height="1" fill="#61ae24"></rect><rect x="6" y="5" width="2" height="1" fill="#61ae24"></rect><rect x="4" y="9" width="4" height="3" fill="black"></rect><rect x="1" y="11" width="10" height="4" fill="black"></rect><rect x="0" y="12" width="12" height="3" fill="black"></rect><rect x="2" y="13" width="1" height="1" fill="white"></rect><rect x="3" y="12" width="1" height="1" fill="white"></rect><rect x="4" y="13" width="1" height="1" fill="white"></rect><rect x="5" y="12" width="1" height="1" fill="white"></rect><rect x="6" y="13" width="1" height="1" fill="white"></rect><rect x="7" y="12" width="1" height="1" fill="white"></rect><rect x="8" y="13" width="1" height="1" fill="white"></rect><rect x="9" y="12" width="1" height="1" fill="white"></rect></svg></i><span><span>Made at the </span><strong>Recurse Center</strong></span></a></div>
<div class="text-wrapper">
  <textarea class="sixkeys" readonly="true">
  </textarea>
</div>
<div class="svg-container">
  <div class="svg-wrapper">
  </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.4.0/d3.min.js"></script>
<script src="./keymap.js"></script>
<script>
  window.onload=function() {
    var keyCombinations = {};
    var homeRow = ["l","k","j","f","d","s"];
    var numPad1 = ["3","2","1","7","8","9"];
    var numPad2 = ["+","6","5","=","/","*"];
    var keys = homeRow;
    var keysPressed = 0;
    var bits = 0;
    var shift = 0;
    var numShift = 0;
    var blueColor = "#97c5d5";
    var svg;

    $(document).keydown(function(e) {
      if (keys.indexOf(e.originalEvent.key) != -1) {
        keysPressed ++;
        if (bits == 7) {
          $(".sixkeys").text($(".sixkeys").text().slice(0,-1));
        } else {
          switch (e.originalEvent.key) {
            case keys[0]: //l
              bits|= 1;
              blurKeys(1);
              break;
            case keys[1]: //k
              bits|= 2;
              blurKeys(2);
              break;
            case keys[2]: //j
              bits|= 4;
              blurKeys(4);
              break;
            case keys[3]: //f
              bits|= 8;
              blurKeys(8);
              break;
            case keys[4]: //d
              bits|= 16;
              blurKeys(16);
              break;
            case keys[5]: //s
              bits|= 32;
              blurKeys(32);
              break;
          }
        }
        return false;
      }
    });

    $(document).keyup(function(e) {
      if (keys.indexOf(e.originalEvent.key) != -1 && bits > 0) {
        switch (bits) {
          case 7: // Backspace
            $(".sixkeys").text($(".sixkeys").text().slice(0,-1));
            break;
          case 18: // Shift & 'Caps Lock'
            shift = (shift + 1) % 3;
            switch (shift) {
              case 1:
                d3.selectAll(".shift").select("path").style("fill","red");
                break;
              case 2:
                d3.selectAll(".shift").select("path").style("fill",blueColor);
                d3.select("#key-caps").select("path").style("fill","red");
                break;
              default:
                d3.select("#key-caps").select("path").style("fill",blueColor);
                break;
            }
            break;
          case 12: // 'Number Shift'
            numShift = (numShift + 2) % 6;
            switch (numShift) {
              case 2:
                d3.select(svg).selectAll(".key:not(.control),.key:not(.numShift1)").style("opacity",0.25);
                break;
              case 4:
                d3.select(svg).selectAll(".key:not(.control),.key:not(.numShift2)").style("opacity",0.25);
                break;
            }
            break;
          default:
            if (bits in letters) {
              $(".sixkeys").append(shift > 0 ? letters[bits][1 + numShift] : letters[bits][0 + numShift]);
              if (shift == 1) {
                shift = 0;
                d3.selectAll(".shift").select("path").style("fill",blueColor);
              }
            }
            break;
        }
      }
      bits = 0;
      keysPressed = 0;
      d3.select(svg).selectAll(".home").style("opacity",1);
      d3.select(svg).selectAll(".mapped:not(#key-caps):not(.shift)").select("path").style("fill",blueColor);
      if (keys.indexOf(e.originalEvent.key) != -1) {
        switch (numShift) {
          case 0:
            d3.select(svg).selectAll(".key").style("opacity",1);
            break;
          case 2:
            d3.select(svg).selectAll(".key.numShift1,.key.control").style("opacity",1);
            break;
          case 4:
            d3.select(svg).selectAll(".key.numShift2,.key.control").style("opacity",1);
            break;
        }
        return false;
      }
    });

    $.get("/6-Key-QWERTY/Qwerty-Second-Homerow.svg", function(data) {
      $(".svg-wrapper").html(data);
      svg = d3.select("#svg2").node();
    },"text")
    .fail(function(xhr,txt,err) {
      console.log(xhr);
      console.log(txt);
      console.log(err);
    });

    function blurKeys(bit) {
      var selectorString;
      switch (numShift) {
        case 0:
          selectorString = ".numShift0";
          break;
        case 2:
          selectorString = ".numShift1";
          break;
        case 4:
          selectorString = ".numShift2";
          break;
      }


      // Reducing the opacity on keys that cannot be typed at the moment
      d3.select(svg).selectAll(".key:not(.control):not("+selectorString+")").style("opacity",0.25);
      var exclude = d3.select(svg).selectAll(".control,"+selectorString).nodes().filter( function(el) {
        return ((parseInt(el.id.split("-")[2]) & bit) == 0);
      });
      d3.selectAll(exclude).style("opacity",0.25);


      // Reduce the opacity of the 'home' keys that are not being pressed currently.
      d3.select(svg).selectAll(".home").style("opacity",0.5);
      var home = d3.select(svg).selectAll(".home").nodes().filter( function(el) {
        return ((parseInt(el.id.split("-")[2]) & bits) > 0);
      });
      d3.selectAll(home).style("opacity",1);


      // Modify the fill of potential keys presses so people know what to press next to type that key
      if (keysPressed == 1) {
        var include = d3.select(svg).selectAll(".control:not(#key-enter-39),"+selectorString).nodes().filter( function(el) {
          return ((parseInt(el.id.split("-")[2]) & bit) > 0);
        })

        d3.selectAll(include).select("path")
        .style("fill", function() {
          var shiftBits = parseInt(this.parentNode.id.split("-")[2]) - bit;
          shiftBits = shiftBits == 0 ? bit : shiftBits;
          var shiftBits2 = shiftBits;
          if (shiftBits2 in keyCombinations) {
            return keyCombinations[shiftBits2][keyCombinations[shiftBits2].length-1]
          } else {
            keyCombinations[shiftBits2] = [];
            var place = 0;
            while (shiftBits > 0) {
              if ( (shiftBits & 1) == 1 ) {
                var tmp = d3.select(svg).selectAll(".home").nodes().filter( function(el) {
                  return (parseInt(el.id.split("-")[2]) == Math.pow(2,place))
                });
                keyCombinations[shiftBits2].push(d3.selectAll(tmp).select("path").style("fill"));
              }
              shiftBits >>>= 1;
              place ++;
            }

            if (keyCombinations[shiftBits2].length == 1) {
              return keyCombinations[shiftBits2][0];
            } else {
              d3.select(svg).select("defs")
              .append("linearGradient")
              .attr("id","gradient-" + shiftBits2)
              .attr("x1","0%")
              .attr("y1","0%")
              .attr("x2","100%")
              .attr("y2","0%")
              .append("stop")
              .attr("offset","50%")
              .attr("style","stop-color:" +keyCombinations[shiftBits2][1]+";stop-opacity:1");
              d3.select("#gradient-" + shiftBits2)
              .append("stop")
              .attr("offset","51%")
              .attr("style","stop-color:" +keyCombinations[shiftBits2][0]+";stop-opacity:1");
              keyCombinations[shiftBits2].push("url(#gradient-"+shiftBits2+")");
              return keyCombinations[shiftBits2][2];
            }
          }

      });
    }

    }

  }
</script>
</body>
</html>
